// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ───────────────────────────────────────────
// Enums
// ───────────────────────────────────────────

enum CoachStatus {
  ACTIVE
  PENDING
  INACTIVE
}

enum OfferingType {
  PRIVATE_LESSON
  GROUP_CLASS
  CLINIC
  RETREAT
}

enum AccountRole {
  ADMIN
  COACH
  STUDENT
}

enum StudentSkillLevel {
  BEGINNER
  ADVANCED_BEGINNER
  INTERMEDIATE
  ADVANCED_INTERMEDIATE
  ADVANCED
  EXPERT
  EXPERT_PRO
}

enum StudentStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum StudentRelationship {
  SELF
  CHILD
  SPOUSE
  OTHER
}

// ───────────────────────────────────────────
// Account / Coach / Student
// ───────────────────────────────────────────

model Account {
  id         String      @id @default(cuid())

  // Maps to Clerk user id
  authUserId String     @unique

  email      String      @unique
  firstName  String
  lastName   String
  phone      String?
  role       AccountRole @default(STUDENT)

  // Relations
  students AccountStudent[] // students this account can manage
  coaches  Coach[]          // coaches this account owns (as a coach)

  createdDate  DateTime @default(now())
  modifiedDate DateTime @updatedAt

  @@index([email])
}

model Coach {
  id        String @id @default(cuid())
  subdomain String @unique

  // auth link
  accountId String?
  account   Account? @relation(fields: [accountId], references: [id])

  firstName    String
  lastName     String
  businessName String
  sport        String

  // Theme / palette
  paletteId                 String
  heroBusinessNameFontClass String

  // Hero configuration
  heroTagline              String
  heroMediaType            String
  heroMediaUrl             String
  heroPrimaryButtonLabel   String
  heroPrimaryButtonSubtext String?
  heroPrimaryButtonTarget  String
  heroPrimaryButtonHref    String?

  // Section titles
  offeringsSectionTitle String
  testimonialsTitle     String
  eventsTitle           String

  // About section
  aboutPhotoUrl       String
  aboutLocation       String
  aboutBio            String
  aboutPhilosophy     String?
  aboutCertifications String?

  // Relations
  coachOfferings CoachOffering[]
  testimonials   Testimonial[]
  events         Event[]
  students       Student[]

  // Admin
  status           CoachStatus @default(ACTIVE)
  createdDate      DateTime    @default(now())
  modifiedDate     DateTime    @default(now())
  statusChangeDate DateTime    @default(now())

  @@index([subdomain])
  @@index([accountId])
}

model Student {
  id        String @id @default(cuid())

  // Which coach this student belongs to
  coachId String
  coach   Coach @relation(fields: [coachId], references: [id], onDelete: Cascade)

  // Identity
  firstName   String
  lastName    String
  email       String?
  phone       String?
  zip         String?
  dateOfBirth DateTime?

  // Skill levels
  skillLevelStudent StudentSkillLevel?
  skillLevelCoach   StudentSkillLevel?

  status StudentStatus @default(ACTIVE)
  notes  String?

  // Optional parent/guardian info (for kids)
  guardianName  String?
  guardianPhone String?
  guardianEmail String?

  // Accounts that can manage this student (parents, self, etc.)
  accounts AccountStudent[]

  createdDate  DateTime @default(now())
  modifiedDate DateTime @updatedAt

  @@index([coachId])
  @@index([lastName])
  @@index([status])
  @@index([email])
}

// Join table: which accounts are linked to which students
model AccountStudent {
  accountId String
  studentId String

  isOwner      Boolean             @default(true)
  relationship StudentRelationship @default(SELF)

  account Account @relation(fields: [accountId], references: [id], onDelete: Cascade)
  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@id([accountId, studentId])
  @@index([studentId])
}

// ───────────────────────────────────────────
// Offerings / Testimonials / Events
// ───────────────────────────────────────────

model CoachOffering {
  id String @id @default(cuid())

  coachId String
  coach   Coach  @relation(fields: [coachId], references: [id], onDelete: Cascade)

  // One row per coach + offering type (e.g. PRIVATE_LESSON)
  type    OfferingType
  enabled Boolean      @default(true)

  // Core public “card” fields
  title        String?
  subtitle     String?
  description  String?
  imageUrl     String?
  priceDisplay String?

  // Reserved for type-specific details (including schedule later)
  configJson Json?

  createdDate  DateTime @default(now())
  modifiedDate DateTime @updatedAt

  // Ensure only one entry per coach per type
  @@unique([coachId, type])
}

model Testimonial {
  id String @id @default(cuid())

  coachId String
  coach   Coach  @relation(fields: [coachId], references: [id], onDelete: Cascade)

  quote  String
  name   String
  detail String?
}

model Event {
  id String @id @default(cuid())

  coachId String
  coach   Coach  @relation(fields: [coachId], references: [id], onDelete: Cascade)

  title     String
  dateLabel String
  type      String
  location  String

  spotsLeft  Int?
  totalSpots Int?

  ctaLabel String
  ctaHref  String
}
