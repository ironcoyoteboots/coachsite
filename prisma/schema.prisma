// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum CoachStatus {
  ACTIVE
  PENDING
  INACTIVE
}

// New: offering types for a coach
enum OfferingType {
  PRIVATE_LESSON
  GROUP_CLASS
  CLINIC
  RETREAT
}

//
// ───────────────────────────────────────────
//  COACH
// ───────────────────────────────────────────
//

model Coach {
  id        String @id @default(cuid())
  subdomain String @unique

  firstName    String
  lastName     String
  businessName String
  sport        String

  // Theme / palette
  paletteId                 String
  heroBusinessNameFontClass String

  // Hero configuration
  heroTagline              String
  heroMediaType            String
  heroMediaUrl             String
  heroPrimaryButtonLabel   String
  heroPrimaryButtonSubtext String?
  heroPrimaryButtonTarget  String
  heroPrimaryButtonHref    String?

  // Section titles
  offeringsSectionTitle String
  testimonialsTitle     String
  eventsTitle           String

  // About section
  aboutPhotoUrl       String
  aboutLocation       String
  aboutBio            String
  aboutPhilosophy     String?
  aboutCertifications String?

  // Relations
  coachOfferings CoachOffering[]
  testimonials   Testimonial[]
  events         Event[]

  // Admin
  status           CoachStatus @default(ACTIVE)
  createdDate      DateTime    @default(now())
  modifiedDate     DateTime    @default(now())
  statusChangeDate DateTime    @default(now())

  @@index([subdomain])
}

model CoachOffering {
  id String @id @default(cuid())

  coachId String
  coach   Coach  @relation(fields: [coachId], references: [id], onDelete: Cascade)

  // One row per coach + offering type (e.g. PRIVATE_LESSON)
  type    OfferingType
  enabled Boolean      @default(true)

  // Core public “card” fields
  title        String?
  subtitle     String?
  description  String?
  imageUrl     String?
  priceDisplay String?

  // Reserved for type-specific details (including schedule later)
  configJson Json?

  createdDate  DateTime @default(now())
  modifiedDate DateTime @updatedAt

  // Ensure only one entry per coach per type
  @@unique([coachId, type])
}

//
// ───────────────────────────────────────────
//  TESTIMONIALS
// ───────────────────────────────────────────
//

model Testimonial {
  id String @id @default(cuid())

  coachId String
  coach   Coach  @relation(fields: [coachId], references: [id], onDelete: Cascade)

  quote  String
  name   String
  detail String?
}

//
// ───────────────────────────────────────────
//  EVENTS
// ───────────────────────────────────────────
//

model Event {
  id String @id @default(cuid())

  coachId String
  coach   Coach  @relation(fields: [coachId], references: [id], onDelete: Cascade)

  title     String
  dateLabel String
  type      String
  location  String

  spotsLeft  Int?
  totalSpots Int?

  ctaLabel String
  ctaHref  String
}
